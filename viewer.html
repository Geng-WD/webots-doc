<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Webots documentation</title>
    <script src='https://www.cyberbotics.com/wwi/8.3/request_methods.js'></script>
    <script src="https://www.cyberbotics.com/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://rawgit.com/showdownjs/showdown/1.3.0/dist/showdown.min.js"></script>
    <script>
      var book = getGETQueryValue("book", "guide");
      var page = getGETQueryValue("page", "guide.md");
      var branch = getGETQueryValue("branch", "feature-webots-doc-importer");
      var targetPath = "https://raw.githubusercontent.com/omichel/webots-doc/" + branch + "/" + book + "/";
      var targetUrl = targetPath + page;
      console.log("Target Url: " + targetUrl);

      function replaceAll(find, replace, str) {
        while( str.indexOf(find) > -1) {
          str = str.replace(find, replace);
        }
        return str;
      }

      $.ajax({
        type: "GET",
        url: targetUrl,
        dataType: "text",
        success: function (result) {
          // hack images urls
          result = replaceAll('](png/', '](' + targetPath + 'png/', result);

          console.log("Raw content: " + result);

          // markdown to html
          var converter = new showdown.Converter();
          document.getElementById("view").innerHTML = converter.makeHtml(result);
        }
    });
    </script>
  </head>
  <body>
    <div id="view"> </div>
  </body>
</html>
